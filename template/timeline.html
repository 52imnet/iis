{{template "header.html" .}}

{{if .IsUserTimeline}}
<div class="status-box">
    <title>@{{.User.ID}} 的时间线</title>

    <div>
    <script>$q('#nav-other a').innerText = "@{{.User.ID}}"; $q('#nav-other').className = "selected"</script>
        {{template "user_public.html" .User}}
    </div>

    {{if .You}}
    <div>
    {{if ne .You.ID .User.ID}}
        {{if .IsUserTimelineFollowed}}
        <button class="gbutton" value onclick="followBlock(this,'follow','{{.User.ID}}')">取消关注</button>
        {{else}}
        <button class="gbutton" value=1 onclick="followBlock(this,'follow','{{.User.ID}}')">关注</button>
        {{end}}

        {{if .IsUserTimelineBlocked}}
        <button class="gbutton" value onclick="followBlock(this,'block','{{.User.ID}}')">解除黑名单</button>
        {{else}}
        <button class="gbutton" value=1 onclick="followBlock(this,'block','{{.User.ID}}')">拉入黑名单</button>
        {{end}}
    {{end}} 

    </div>

    {{end}}
</div>
{{else if .IsInbox}}
    <title>我的提醒</title>
    <script>$q('#nav-inbox').className = "selected"</script>
<div class="status-box">
        {{template "user_private.html" .You}}
</div>
{{else if eq .User.ID "master"}}
    <title>全局时间线</title>
    <script>$q('#nav-master').className = "selected"</script>
{{else if .IsUserLikeTimeline}}
<div class="status-box">
    {{if eq .You.ID .User.ID}}
        {{template "user_private.html" .You}}
    {{else}}
        {{template "user_public.html" .User}}
    {{end}}
</div>
    <title>@{{.User.ID}}的收藏</title>
    <script>$q('#nav-likes a span').innerText = "@{{.User.ID}}";$q('#nav-likes').className = "selected"</script>
{{else if .IsTagTimeline}}
    <title>#{{.Tag}}</title>
    <script>$q('#nav-other a').innerText = "#{{.Tag}} ({{.PostsUnderTag}})"; $q('#nav-other').className = "selected"</script>

<div class="status-box">
    <div>
        {{if .IsTagTimelineFollowed}}
        <button class="gbutton" value onclick="followBlock(this,'follow','#{{.Tag}}')">取消关注</button>
        {{else}}
        <button class="gbutton" value=1 onclick="followBlock(this,'follow','#{{.Tag}}')">关注</button>
        {{end}}
    </div>
</div>

{{else}}
<div class="status-box">
        <title>我的时间线</title>
    <div>
        <script>$q('#nav-own').className = "selected"</script>
        {{template "user_private.html" .User}}
    </div>
    {{if .ShowNewPost}}
    <div style="padding:0 0.5em">{{template "reply_view.html" .ReplyView}}</div>
    {{end}}
</div>
{{end}}

{{if not .IsInbox}}
<nav>
    <ul>
        <li id="nav-own" class="secondary {{if not .MediaOnly}}selected{{end}}"><a href="?media=">全部</a></li>
        <li id="nav-master" class="secondary {{if .MediaOnly}}selected{{end}}"><a href="?media=1">只看图片</a></li>
    </ul>
</nav>
{{end}}

{{if .ReplyView.PID}}<script>showReply('{{.ReplyView.PID}}');</script>{{end}}

<div class="rows" id=timeline>
    {{range .Articles}}
        {{template "row_content.html" .}}
    {{end}}
</div>

<div class=paging>
    {{if .Next}}
    <button
        value="{{.Next}}"
        class="gbutton load-more"
        onclick="loadMore('timeline',this,{likes:{{.IsUserLikeTimeline}},media:{{.MediaOnly}},})">更多...</button>

    <script>
        preLoadMore("timeline", $q("#timeline + .paging > .load-more"))
    </script>

    {{else}}
        <a class=gbutton style="color:#aaa"
        {{if .IsUserTimeline}}
            href="/t/{{.User.ID}}">没有更多{{.User.ID}}的状态了</a>
        {{else if .IsInbox}}
            href="/t/:in">没有更多提醒了</a>
        {{else if eq .User.ID "master"}}
            href="/t/master">没有更多状态了</a>
        {{else}}
            href="/t">没有更多状态了</a>
        {{end}}
    {{end}}
</div>
