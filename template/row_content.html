<div data-id="{{.ID}}" style="padding:0.5em 0.5em 0 0.5em" class="row">
    {{if .NoAvatar}}
    <div class="row-header">
    {{else}}
    <div class="row-header" style="line-height:36px">
        <img class="avatar" alt="{{.Author.ID}}"
            {{if .Author.Avatar}}
            src="{{.Author.Avatar}}"
            {{else}}
            src="/avatar/{{.Author.ID}}.jpg" style="opacity:0.6"
            {{end}}>
        {{if .Author.Kimochi}}
        <img src="/s/emoji/emoji{{.Author.Kimochi}}.png"
            style="width:20px;height:20;position:absolute;left:32px;top:6px;-webkit-filter: drop-shadow(0 0 3px rgba(0,0,0,0.2));">
        {{end}}
    {{end}}

    {{if eq .Cmd "inbox-reply"}}
        <a href="/t/{{.Author.ID}}">@{{.Author.ID}}</a>
        <span>于 {{formatTime .CreateTime}} 回复了你</span>
    {{else if eq .Cmd "inbox-mention"}}
        <a href="/t/{{.Author.ID}}">@{{.Author.ID}}</a>
        <span>于 {{formatTime .CreateTime}} @了你</span>
    {{else}}
        <span>
            <a target=_parent href="/t/{{.Author.ID}}">@{{.Author.ID}}</a>
            {{if .Author.IsMod}} <span class=mod>Mod</span>{{end}}
            {{if .You.IsMod}} <a href="/mod/user?uid={{.Author.ID}}" target=_blank><i class="icon-export-alt"></i></a>{{end}}
        </span>
        {{if .Parent}}
            {{if .Content}}
                <span>回复于 {{formatTime .CreateTime}}</span>
            {{else}}
                <span>转发于 {{formatTime .CreateTime}}</span>
            {{end}}
        {{else}}
            <span>发布于 {{formatTime .CreateTime}}</span>
        {{end}}
    {{end}}
    </div>

    {{if eq .MediaType "IMG"}}
    <div style="margin-top:0.5em">
    {{if or .NSFW .You.FoldImages}}
    <button
        style="color:{{if .NSFW}}#f90{{else}}#098{{end}}"
        onclick="this.style.display='none';this.nextElementSibling.querySelector('img').src='{{.Media}}'"
        class="gbutton nsfw-clicker">
        {{if .NSFW}}展开NSFW图片{{else}}展开图片{{end}}
    </button>
    <a href="{{.Media}}" target=_blank>
        <img
    {{else}}
    <a href="{{.Media}}" target=_blank>
        <img src="{{.Media}}"
    {{end}}
            style="border-radius:5px;display:block;max-width:300px;max-height:300px">
    </a>
    </div>
    {{end}}

    {{if .Content}}
    <pre style="padding:0.66em 0 0">{{.ContentHTML}}</pre>
    {{end}}

    <div style="padding: 0.5em 0;line-height:1.5em">
        <a class="reply-box" href="javascript:showReply('{{.ID}}')">
            <i class="icon-reply-outline"></i> {{if .Replies}}{{.Replies}}{{end}}
        </a>
        <a class="reply-box" href="javascript:void(0)" onclick="likeArticle(this, '{{.ID}}')" liked={{.Liked}}>
            <i class="icon-heart-{{if .Liked}}filled{{else}}1{{end}}"></i> <span class=num>{{if .Likes}}{{.Likes}}{{end}}</span>
        </a>
        {{$own := eq .You.ID .Author.ID}}
        {{if or $own .You.IsMod}}
        <a class="reply-box" href="javascript:void(0)" onclick="deleteArticle(this,'{{.ID}}')" style="color:#f52">
            <i class="icon-trash"></i>
        </a>
        <a class="reply-box" href="javascript:void(0)"
                             onclick="nsfwArticle(this,'{{.ID}}')"
                             style="color:{{if .NSFW}}#f90{{else}}#bbb{{end}}" value={{.NSFW}}>
            <i class="icon-transgender-alt"></i>
        </a>
        {{end}}
    </div>

    {{if .Parent}}
    {{if .Parent.ID}}
    <div style="position:relative;margin:0 -0.5em; border-top:dotted 1px #aaa">
        <i style="position: absolute; left: -12px; top: -1px; border-color: #aaa transparent transparent; display: block; border-width: 12px; border-style: solid;"></i>
    </div>

    <div class="subreply">
        {{template "row_content.html" .Parent}}
    </div>
    {{end}}
    {{end}}
</div>
