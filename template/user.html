{{template "header.html" .}}

{{if .User}}

<title>{{.User.ID}}</title>

<table class="articles" style="margin: 0.5em 0">
    <tr>
        <td colspan=3 style="text-align:center"><b>{{.User.ID}}</b> 的设置</td>
    </tr>
    <tr>
        <td>上次登入:</td>
        <td>{{.User.Login.Format "2006-01-02 15:04:05"}}</td>
        <td rowspan=2><form method="POST" action="/user">
                <input type=hidden name=uuid value="{{.UUID}}">
                <input type=hidden name=username value="{{.User.ID}}">
                <input type=hidden name=method value="logout">
                <button style="color:#f52" class="gbutton" type=submit>注销</button>
            </form></td>
    </tr>
    <tr>
        <td>注册于:</td>
        <td>{{.User.Signup.Format "2006-01-02 15:04:05"}}</td>
    </tr>
    <tr>
        <td class=nowrap>上次登入IP:</td><td colspan=2>{{.User.LoginIP}}</td>
    </tr>
    <tr>
        <td class=nowrap>注册IP:</td><td colspan=2>{{.User.SignupIP}}</td>
    </tr>

    <form method="POST" action="/user">
        <tr>
            <td class=nowrap>头像URL:</td>
            <td colspan=2> 
                <input type=hidden name=uuid value="{{.UUID}}">
                <input type=hidden name=method value="update-info">
                <input type=hidden name=username value="{{.User.ID}}">
                <input class=t name=avatar value="{{.User.Avatar}}" maxlength=256>
            </td>
        </tr>
        <tr>
            <td class=nowrap>Email:</td>
            <td colspan=2> 
                <input name=email class=t value="{{.User.Email}}" required type=email>
            </td>
        </tr>
        <tr>
            <td class=nowrap></td>
            <td colspan=2> 
                <input name=nrit type=checkbox {{if .User.NoReplyInTimeline}}checked{{end}} id=nrit>
                <label for=nrit>不要将我的回复显示在我的时间线中</label>
            </td>
        </tr>
        <tr>
            <td class=nowrap></td>
            <td colspan=2> 
                <input name=npim type=checkbox {{if .User.NoPostInMaster}}checked{{end}} id=npim>
                <label for= npim>不要将我的状态显示在Master时间线中</label>
            </td>
        </tr>
        <tr>
            <td colspan=2>
                {{if .EError}}{{template "error_i18n.html" .EError}}{{end}}
            </td>
            <td class=nowrap>
                <button class="gbutton" type=submit>更新</button>
            </td>
        </tr>
    </form> 

    {{if .User.IsMod}}
    <tr>
        <td class=nowrap>最大耗时:</td>
        <td>{{.Survey.Max}}ms</td>
    </tr>
    <tr>
        <td class=nowrap>流出流量:</td>
        <td>{{.Survey.Written}}b</td>
    </tr>
    {{end}}
</table>


{{else}}

<title>登入/注册</title>

<form method="POST" action="/user">
    <table class="articles">
        <input type=hidden name=uuid value="{{.UUID}}">
        <input type=hidden name=method value="login">
        <tr>
            <td class=nowrap>用户名:</td>
            <td><input autofocus class=t name=username value="{{.RUsername}}"></td>
        </tr>
        <tr>
            <td class=nowrap>密码:</td>
            <td><input type=password class=t name=password value="{{.RPassword}}"></td>
        </tr>
        {{if .LoginError}}
        <tr>
            <td></td><td>{{template "error_i18n.html" .LoginError}}</td>
        </tr>
        {{end}}
        <tr>
            <td>
            </td> 
            <td style="text-align:right">
                <button class="gbutton" type=submit>登入</button>
            </td>
        </tr>
</form>
    <tr><td colspan=2><hr></td></tr>
    <tr><td colspan=2><b>注册新用户</b></td></tr>

<form method="POST" action="/user">
    <input type=hidden name=uuid value="{{.UUID}}">
    <input type=hidden name=method value="signup">
    <tr>
        <td>用户名:</td>
        <td><input class=t name=username value="{{.RUsername}}"></td>
    </tr>
    <tr>
        <td></td><td style="font-size:90%">3~15英文，2~7中文</td>
    </tr>
    <tr>
        <td class=nowrap>密码: </td>
        <td><input type=password class=t name=password value="{{.RPassword}}"></td>
    </tr>
    <tr>
        <td class=nowrap>重复密码:</td>
        <td><input type=password class=t name=password2 value="{{.RPassword}}"></td>
    </tr>
    <tr>
        <td>Email:</td>
        <td><input class=t name=email value="{{.REmail}}"></td>
    </tr>
    <tr>
        <td></td>
        <td>
<button name=refresh value=1 type=submit class=none>
                <img src="data:image/png;base64,{{.Challenge}}">
            </button>
        </td>
    </tr>
    <tr>
        <td class=nowrap>验证码:</td>
        <td><input size=10 name="answer" class=s></td>
    </tr> 
    {{if .EError}}
    <tr>
        <td></td><td>{{template "error_i18n.html" .EError}}</td>
    </tr>
    {{end}}
    <tr>
        <td></td> <td style="text-align:right">
            <button class="gbutton" type=submit>注册</button>
        </td>
    </tr>
</table>
</form>
{{end}}

