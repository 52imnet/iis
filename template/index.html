{{template "header.html" .}}

    {{if .ParentArticle}}

        {{if .ParentArticle.Title}}
        <title>{{.ParentArticle.Title}}</title>
        {{else}}
        <title>回复: {{.ParentArticle.DisplayID}}</title>
        {{end}}

        {{with .ParentArticle}}
        <table class="articles small">
            <tr>
                <th>主题: {{.DisplayID}}</th>
                <th class=nowrap>回/看</th>
                <th class=nowrap>作者</th>
                <th class=nowrap>日期</th>
            </tr>
            <tr class="row">
                <td>
                    {{if .Parent}}<a href="/p/{{.DisplayParentID}}">上一层</a> /{{end}} 
                    {{template "row_tags.html" .}}
                </td>
                <td class=nowrap><span>{{.Replies}}/{{.Views}}</span></td>
                <td class=nowrap>
                    <a href="/id/{{.Author}}">{{.Author}}</a>{{if $.ShowIP}} / {{.IP}}{{end}}
                </td>
                <td class="nowrap date"><span>{{.CreateTimeString true}}</span></td>
                </td>
            </tr>
            <tr class=dark>
                <td colspan=4><div class=reply><pre>{{.ContentHTML}}</pre></div></td>
            </tr>
        {{end}}

        {{if len .Articles}}
            {{range .Articles}}
            <tr class="row">
                <td><b>{{.Index}}</b>. <a href="/p/{{.DisplayID}}">{{.Title}}</a></td>
                <td class=nowrap>{{.Replies}}/{{.Views}}</td> 
                <td class=nowrap><a href="/id/{{.Author}}">{{.Author}}</a>{{if $.ShowIP}} / {{.IP}}{{end}}</td>
                <td class="nowrap date">{{.CreateTimeString true}}</td>
            </tr>
            <tr class="dark">
                <td colspan=4><div class=reply><pre>{{.ContentHTML}}</pre></div></td>
            </tr>
            {{end}}
        {{else}}
            <tr><td colspan=4>无回复</td></tr>
        {{end}}
        </table>

        <table class="articles">
        <tr>
            <td colspan=4>
                {{with .ReplyView}}
                <input class="reply-toggle" style="display:none" type=checkbox id="reply" {{if .ShowReply}}checked{{end}}>
                <label class="pure-material-button-outlined" for=reply><b>回复该主题</b></label>
                <div class="reply-view">
                    <form method="POST" action="/reply">
                        <table class="articles">
                            <input type=hidden name=uuid value="{{.UUID}}">
                            <input type=hidden name=reply value="{{$.ParentArticle.DisplayID}}">
                            <tr>
                                <td style="color:#888" class=nowrap>ID (选填)</td>
                                <td colspan=2><input style="border: none" class=t name=author value="{{.RAuthor}}"></td>
                            </tr>
                            <tr>
                                <td colspan=3>
                                    <textarea placeholder="内容" style="border:none;padding:0" rows=10 name="content">{{.RContent}}</textarea>
                                </td>
                            </tr>
                            <tr style="border:none">
                                <td colspan=3>
                                    <button name=refresh value=1 type=submit class="none"><img src="data:image/png;base64,{{.Challenge}}"></button>
                                </td>
                            </tr>
                            <tr>
                                <td style="color:#888" class=nowrap>验证码</td>
                                <td>
                                    <input size=10 name="answer" class=s>
                                </td>
                                <td class=nowrap>
                                    <button class="pure-material-button-outlined" type=submit>发布</button>
                                    <a class="pure-material-button-outlined" href="/p/{{$.ParentArticle.DisplayID}}">取消</a>
                                </td>
                            </tr> 
                            {{if .EError}}
                            <tr>
                                <td colspan=3>错误: {{.EError}}</td>
                            </tr>
                            {{end}}
                        </table>
                    </form>
                </div>
                <div class="bg"></div>
                {{end}}
                <a style="float:right" class="pure-material-button-outlined" href="/edit/{{.ParentArticle.DisplayID}}">删除</a>
            </td>
        </tr>
        </table>

    {{else}}

        <table class="articles small">
            <tr>
                {{if eq .Type "id"}}
                <title>{{.SearchTerm}}的相关发言 {{.Title}}</title>
                <th>
                    {{.SearchTerm}}的相关发言 ({{.TotalCount}})
                </th>
                {{else if eq .Type "tag"}}
                <title>标签: {{.SearchTerm}} {{.Title}}</title>
                <th>标签 ({{.TotalCount}})</th>
                {{else}}
                <title>时间线 {{.Title}}</title>
                <th>标题</th>
                {{end}}
                <th class=nowrap>回/看</th>
                <th class=nowrap>作者</th>
                <th class=nowrap>日期</th>
            </tr>
        {{if len .Articles}}
        {{range .Articles}}
        <tr class="row">
            <td>{{template "row_tags.html" .}}</td>
            <td class=nowrap><span>{{.Replies}}/{{.Views}}</span></td>
            <td class=nowrap><a href="/id/{{.Author}}">{{.Author}}</a></td>
            <td class="nowrap date"><span>{{.CreateTimeString false}}</span></td>
        </tr>
        {{if .Parent}}
        <tr class=dark>
            <td colspan=4><div class=reply><pre>{{.ContentAbstract}}</pre></div></td>
        </tr>
        {{end}}
        {{end}}
        {{else}}
        <tr><td colspan=4>无内容</td></tr>
        {{end}}
        </table>

    {{end}}

    <div class="paging" id="paging">
        {{if not .NoPrev}}
        <a href="?n=0">首页</a>
        <a href="?n=-{{.Prev}}">&laquo; 上页</a>
        {{end}}
        {{if not .NoNext}}
        <a href="?n={{.Next}}">下页 &raquo;</a>
        <a href="?n=-0">末页</a>
        {{end}}
    </div>

{{template "footer.html" .}}
