{{template "header.html" .}}

<title>第{{.CurPage}}页</title>

{{with .ParentArticle}}
<div style="padding:0.5em;line-height:2em">
    {{if not .Parent}}<a href="/cat/{{.Category}}" style="color:black;margin-right:1em">#{{.Category}}</a>{{end}}
    <b>{{template "row_tags.html" .}}</b>
</div>
{{end}}

<div class="rows"> 
    {{template "row_content.html" .ParentArticle}}

    <div class=row style="padding:0.33em">
        {{with .ReplyView}}
        <input class="reply-toggle" style="display:none" type=checkbox id="reply" {{if .ShowReply}}checked{{end}}>
        <label class="gbutton" for=reply><b>回复主题</b></label>
        <div class="reply-view">
            <form method="POST" action="/reply">
                <table class="articles">
                    <input type=hidden name=uuid value="{{.UUID}}">
                    <input type=hidden name=reply value="{{$.ParentArticle.ID}}">
                    <tr>
                        <td>
                            <textarea maxlength=4000 placeholder="内容" style="border:none;padding:0" rows=12 name="content">{{.RContent}}</textarea>
                        </td>
                    </tr>
                    <tr style="border-top:solid 1px #ccc;text-align:right">
                        <td>
                            <button {{if $.ParentArticle.Locked}}disabled{{end}} class="gbutton" type=submit>回复</button>
                            <a class="gbutton" href="/p/{{$.ParentArticle.ID}}">取消</a>
                        </td>
                    </tr> 
                    {{if .EError}}
                    <tr style="border-top:solid 1px #ccc">
                        <td colspan=3>错误: {{template "error_i18n.html" .EError}}</td>
                    </tr>
                    {{end}}
                </table>
            </form>
        </div>
        <div class="bg"></div>
        {{end}}
        {{if .ParentArticle.Parent}}
        <a class="gbutton" href="/p/{{.ParentArticle.Parent}}?j={{.ParentArticle.ID}}">上一层</a>
        <a class="gbutton" href="/p/{{.ParentArticle.TopParent}}">顶层</a>
        {{else}}
        <a class="gbutton" href="/cat?n={{.ParentArticle.Timeline}}">下一个主题</a>
        {{end}}
        {{if .CanDeleteParent}}
        <a class="gbutton" href="/edit/{{.ParentArticle.ID}}">删除</a>
        {{end}}
    </div>

    {{if len .Articles}}
    {{range .Articles}}
        {{template "row_content.html" .}}
    {{end}}
    {{else}}
    <div class=row style="text-align:center;padding:1em">无回复</div>
    {{end}}
</div>

<div class="paging" id="paging">
    <a href="?p=0">&laquo; 首页</a>
    {{range .Pages}}
    {{if eq . $.CurPage}}
    <a style="color:black"><b>{{.}}</b></a>
    {{else}}
    <a href="?p={{.}}">{{.}}</a>
    {{end}}
    {{end}}
    <a href="?p=-1">末页 &raquo;</a>
</div>

