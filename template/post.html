{{template "header.html" .}}

{{with .ParentArticle}}
<title>{{.Title}} - 第{{$.CurPage}}页</title>

<table class="articles small">
    <tr>
        <th><b>{{.Index}}</b>.</th>
        <th class=nowrap>作者</th>
        <th class=nowrap>回复</th>
        <th class=nowrap>浏览</th>
        <th class=nowrap>日期</th>
    </tr>
    <tr class="row">
        <td class="row">
            {{if .Parent}}<a href="/p/{{.DisplayParentID}}">上一层</a> /{{end}} 
            {{template "row_tags.html" .}}
        </td>
        <td class=nowrap><a href="/id/{{.Author}}">{{.Author}}</a></td>
        <td class="nowrap" align=center><span>{{len .Replies}}</span><span class=mobile>回复</span></td>
        <td class="nowrap" align=center><span>{{.Views}}</span><span class=mobile>浏览</span></td>
        <td class="nowrap date"><span>{{.CreateTimeString true}}</span></td>
        </td>
    </tr>
    <tr class=dark>
        <td colspan=5><div class=reply><pre>{{.ContentHTML}}</pre>{{if $.ShowIP}}<div class="ip">{{.IP}}</div>{{end}}</div></td>
    </tr>
    {{end}}

    {{if len .Articles}}
    {{range .Articles}}
    <tr class="row">
        <td><b>{{.Index}}</b>. <a href="/p/{{.DisplayID}}">{{.Title}}</a></td>
        <td class=nowrap><a href="/id/{{.Author}}">{{.Author}}</a></td>
        <td class="nowrap" align=center>
            {{if len .Replies}}
            <span>{{len .Replies}}</span><span class=mobile>回复</span>
            {{end}}
        </td>
        <td class="nowrap" align=center>
            {{if .Views}}
            <span>{{.Views}}</span><span class=mobile>浏览</span>
            {{end}}
        </td>
        <td class="nowrap date">{{.CreateTimeString true}}</td>
    </tr>
    <tr class="dark">
        <td colspan=5><div class=reply><pre>{{.ContentHTML}}</pre>{{if $.ShowIP}}<div class="ip">{{.IP}}</div>{{end}}</div></td>
    </tr>
    {{end}}
    {{else}}
    <tr><td colspan=5>无回复</td></tr>
    {{end}}
</table>

<table class="articles">
    <tr>
        <td colspan=4>
            {{with .ReplyView}}
            <input class="reply-toggle" style="display:none" type=checkbox id="reply" {{if .ShowReply}}checked{{end}}>
            <label class="pure-material-button-outlined" for=reply><b>回复该主题</b></label>
            <div class="reply-view">
                <form method="POST" action="/reply">
                    <table class="articles">
                        <input type=hidden name=uuid value="{{.UUID}}">
                        <input type=hidden name=reply value="{{$.ParentArticle.DisplayID}}">
                        <tr>
                            <td style="color:#888" class=nowrap>ID (选填)</td>
                            <td colspan=2><input style="border: none" class=t name=author value="{{.RAuthor}}"></td>
                        </tr>
                        <tr>
                            <td colspan=3>
                                <textarea placeholder="内容" style="border:none;padding:0" rows=10 name="content">{{.RContent}}</textarea>
                            </td>
                        </tr>
                        <tr style="border:none">
                            <td colspan=3>
                                <button name=refresh value=1 type=submit class="none"><img src="data:image/png;base64,{{.Challenge}}"></button>
                            </td>
                        </tr>
                        <tr>
                            <td style="color:#888" class=nowrap>验证码</td>
                            <td>
                                <input size=10 name="answer" class=s>
                            </td>
                            <td class=nowrap>
                                <button class="pure-material-button-outlined" type=submit>发布</button>
                                <a class="pure-material-button-outlined" href="/p/{{$.ParentArticle.DisplayID}}">取消</a>
                            </td>
                        </tr> 
                        {{if .EError}}
                        <tr>
                            <td colspan=3>错误: {{.EError}}</td>
                        </tr>
                        {{end}}
                    </table>
                </form>
            </div>
            <div class="bg"></div>
            {{end}}
            <a style="float:right" class="pure-material-button-outlined" href="/edit/{{.ParentArticle.DisplayID}}">删除</a>
        </td>
    </tr>
</table>

<div class="paging" id="paging">
    <a href="?p=0">&laquo; 首页</a>
    {{range .Pages}}
    {{if eq . $.CurPage}}
    <a style="color:black"><b>{{.}}</b></a>
    {{else}}
    <a href="?p={{.}}">{{.}}</a>
    {{end}}
    {{end}}
    <a href="?p=-1">末页 &raquo;</a>
</div>

{{template "footer.html" .}}
